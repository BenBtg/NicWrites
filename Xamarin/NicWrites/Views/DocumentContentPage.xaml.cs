using System;
using System.Collections.Generic;
using Microsoft.MobCAT.Forms.Pages;
using Xamarin.Forms;

namespace NicWrites.Views
{
    public partial class DocumentContentPage : BaseContentPage<ViewModels.DocumentContentViewModel>
    {
        // const string embedded = "\n**Kharkov the Magician**\n\n**By Oscar Withers and Nic Ryan**\n\n** **\n\n**(Anna opens the doors to the theatre to let in the audience)**\n\n**Anna:** Were you followed here? No? Good. We are all in grave danger. We will be quick. You will enjoy it. Then you will leave. Understand? Yes? Good.\n\nIf you breathe a word of this to anyone, we will surely be taken.\n\nYour faces will be scratched out of all photos, your families will never speak of you again. It will be like you never existed.\n\nEnjoy the show.\n\n**(Anna Exits, Kharkov enters)**\n\n**Kharkov/Narrator:**\\n\\nLadies and gentlemen, I hope you are well.\\n\\nFor today, if I may, I have a story to tell.\\n\\nSome context, first. We live under a dictator.\\n\\nWho threatens to oppress our cast and me, your humble narrator.\\n\\nA circus troupe is the focus of our story,\\n\\nA tale of love, murder, and fallen glory.\\n\\nAnd so, dear audience, with your permission,\\n\\nAllow me to tell you the tale, of Kharkov the Magician.\\n\\n**[Anna and Ingov join the stage]**\\n\\n**Narrator:** Kharkov the Magician had a small circus troupe, joined by his friends; Anna Ingovich, and Ingov Annavich. Ingov had a clubbed foot. This is not important to the story.\\n\\nOne day, Kharkov the Magician fell to his knees, and cried.\\n\\n**[Kharkov**  **falls to the floor and cries****]**\\n\\n**Anna:** Oh, Kharkov. You really must stop moping!\\n\\n**Kharkov:** Oh, it is sad! There is nothing for us to show! We have no big act!\\n\\n**Ingov:** There, there, Kharkov. **[Ingov &quot;pats&quot; Kharkov&#39;s back. In reality, he slaps his back]**\\n\\n**Kharkov:** Thank you, Ingov. For your concern. But it does not help.\\n\\n**Ingov:** Why not, Kharkov?\\n\\n**Anna:** Because none of us can read, Ingov.\\n\\n**Kharkov:** And Comrade Batski has declared all citizens must read. I do not want to read! I want to perform!...Oh, it is sad! A performer with nothing to perform.\\n\\n**Anna:** Oh, Kharkov! Snap out of it. Your moping, I cannot bear it anymore!\\n\\n**Narrator:** Kharkov the Magician looked up to Anna.\\n\\n**Anna:** Oh, oh I&#39;m sorry I didn&#39;t mean to talk out of place….\\n\\n**Kharkov:** A bear! Yes! With something of a bear, we would have a show!\\n\\n**Anna:** And, what could possibly go wrong with a bear in the show?\\n\\n**Kharkov:** Absolutely nothing!\\n\\n**Narrator:** Little did Kharkov the Magician know, that everything could, and will, go wrong.\\n\\n**Section 2:**\\n\\n**Anna:** So Kharkov Went to buy a bear, there were blue bears, green bears, stuffed bears, real bears, big bears, small bears, and some with the hereditary propensity to alcohol and violent outbursts, bears. The one he chose had a unicycle, which was fine, but the bear was broken.\\n\\n**(The bear is dragged on by Kharkov)**\\n\\n**Kharkov:** You will follow my instruction, or I will turn you into a floor rug. You will learn our ways, what tricks do you know?\\n\\n**Bear** : I don&#39;t know, I&#39;m just a bear being a bear**. (He proceeds to unicycle.)**\\n\\n**Kharkov:** Good. You will line my pockets with gold.\\n\\n**Anna:** Oh Bear, you unicycle beautifully!\\n\\nBut this must you know, what Kharkov demands from our show.\\n\\n**Ingov:** We go without food and sleep,\\n\\nIn order to earn our keep.\\n\\n**Anna:** However, should we fail to achieve,\\n\\nWe&#39;ll get Kharkov&#39;s wrath, and probably a baseball bat to the knees.\\n\\n**Section 3:**\\n\\n**Narrato** r: Kharkov was a tyrant, the very cruellest of magicians. He cared not for the safety of his assistants. Often when their tricks went gruesomely wrong he would carelessly dispose and replace them with little thought to their families.\\n\\n**(Ingov has been injured, he cries out in pain.)**\\n\\n**Anna:** This never would have happened if Arav were here.\\n\\n**Bear** : Who was he?\\n\\n**Ingov** : The assistant before me.\\n\\n**(Anna drags on a suitcase)**\\n\\n**Anna:** Meet Arav. We found this in the woods last week, he was so full of potential, all those hours of rehearsal, wasted!\\n\\n**Bear** : How&#39;d you know it was him?\\n\\n**Anna** : He was a contortionist, only he could fit inside, whole, or as he is now. But mostly by his dental records.\\n\\n**Ingov:** But he was paranoid, he felt Comrade Batski was having him watched. He insisted we change our rehearsal spaces regularly, but now he&#39;s gone, we came back here.\\n\\n**Anna** : Kharkov insisted that we stay here, but Arav&#39;s suspicions about Men in black proved too much for him. Words were exchanged, and Arav..\\n\\n**Kharkov** : What are you doing with MY suitcase?\\n\\n**All:** (**Whisper aside to audience)** Kharkov is a tyrant.\\n\\n**Ingov:** He will take us away, and we will never be seen again.\\n\\n**All:** Kharkov has a terrible temper. Kharkov sees all.\\n\\n**Kharkov:** Why do you whisper? Do you plan to conspire?\\n\\n**(Silence/shock)**\\n\\n**Kharkov** : Hop to it. Positions for my new trick.\\n\\nLadies and gentlemen, I give you, &quot;People in Russia don&#39;t really go missing&quot;…  A metamorphosis!\\n\\n**(They perform trick)**\\n\\nKharkov: Not good enough, again!\\n\\n**(They perform the trick again, but Anna does not re-appear. Moment of silence and shock.)**\\n\\n**Narrator:** Before I let events continue. I feel obligated to inform you all that…Ingov was furiously in love with Anna, who was furiously in love with the Broken bear. However the bear, despite appreciating the affection that Anna poured upon him, saw her only as a motherly figure.\\n\\n**Ingov:** My love…what have you done with her?\\n\\n**Bear:…** Mama?\\n\\n**(They search for her, and discover an arm)**\\n\\n**Ingov:** I&#39;ll skin you alive, you fleabag!\\n\\n**(Fight scene/murder of Ingov)**\\n\\n**Kharkov:**  Stop! Stop I say, at once!\\n\\n**(Ingov dies a painful death)**\\n\\n**Kharkov:** Look what you&#39;ve done! We&#39;re ruined!\\n\\n**Narrator:** And for one final time, Kharkov dropped to his knees and cried…\\n\\n**(Bear removes mask and approaches Kharkov)**\\n\\n**Kharkov:** Comrade Batski! No, it can&#39;t be!\\n\\n**(Comrade Batski fires a single shot,  Kharkov drops dead, Comrade Batski turns his gun on the audience. BLACKOUT.)**\\n\\n\";


        //const string embedded = "**Kharkov the Magician**\n\n**By Oscar Withers and Nic Ryan**\n\n** **\n\n**(Anna opens the doors to the theatre to let in the audience)**\n\n**Anna:** Were you followed here? No? Good. We are all in grave danger. We will be quick. You will enjoy it. Then you will leave. Understand? Yes? Good.\n\nIf you breathe a word of this to anyone, we will surely be taken.\n\nYour faces will be scratched out of all photos, your families will never speak of you again. It will be like you never existed.\n\nEnjoy the show.\n\n**(Anna Exits, Kharkov enters)**\n\n**Kharkov/Narrator:**\n\nLadies and gentlemen, I hope you are well.\n\nFor today, if I may, I have a story to tell.\n\nSome context, first. We live under a dictator.\n\nWho threatens to oppress our cast and me, your humble narrator.\n\nA circus troupe is the focus of our story,\n\nA tale of love, murder, and fallen glory.\n\nAnd so, dear audience, with your permission,\n\nAllow me to tell you the tale, of Kharkov the Magician.\n\n**[Anna and Ingov join the stage]**\n\n**Narrator:** Kharkov the Magician had a small circus troupe, joined by his friends; Anna Ingovich, and Ingov Annavich. Ingov had a clubbed foot. This is not important to the story.\n\nOne day, Kharkov the Magician fell to his knees, and cried.\n\n**[Kharkov**  **falls to the floor and cries****]**\n\n**Anna:** Oh, Kharkov. You really must stop moping!\n\n**Kharkov:** Oh, it is sad! There is nothing for us to show! We have no big act!\n\n**Ingov:** There, there, Kharkov. **[Ingov &quot;pats&quot; Kharkov&#39;s back. In reality, he slaps his back]**\n\n**Kharkov:** Thank you, Ingov. For your concern. But it does not help.\n\n**Ingov:** Why not, Kharkov?\n\n**Anna:** Because none of us can read, Ingov.\n\n**Kharkov:** And Comrade Batski has declared all citizens must read. I do not want to read! I want to perform!...Oh, it is sad! A performer with nothing to perform.\n\n**Anna:** Oh, Kharkov! Snap out of it. Your moping, I cannot bear it anymore!\n\n**Narrator:** Kharkov the Magician looked up to Anna.\n\n**Anna:** Oh, oh I&#39;m sorry I didn&#39;t mean to talk out of place….\n\n**Kharkov:** A bear! Yes! With something of a bear, we would have a show!\n\n**Anna:** And, what could possibly go wrong with a bear in the show?\n\n**Kharkov:** Absolutely nothing!\n\n**Narrator:** Little did Kharkov the Magician know, that everything could, and will, go wrong.\n\n**Section 2:**\n\n**Anna:** So Kharkov Went to buy a bear, there were blue bears, green bears, stuffed bears, real bears, big bears, small bears, and some with the hereditary propensity to alcohol and violent outbursts, bears. The one he chose had a unicycle, which was fine, but the bear was broken.\n\n**(The bear is dragged on by Kharkov)**\n\n**Kharkov:** You will follow my instruction, or I will turn you into a floor rug. You will learn our ways, what tricks do you know?\n\n**Bear** : I don&#39;t know, I&#39;m just a bear being a bear**. (He proceeds to unicycle.)**\n\n**Kharkov:** Good. You will line my pockets with gold.\n\n**Anna:** Oh Bear, you unicycle beautifully!\n\nBut this must you know, what Kharkov demands from our show.\n\n**Ingov:** We go without food and sleep,\n\nIn order to earn our keep.\n\n**Anna:** However, should we fail to achieve,\n\nWe&#39;ll get Kharkov&#39;s wrath, and probably a baseball bat to the knees.\n\n**Section 3:**\n\n**Narrato** r: Kharkov was a tyrant, the very cruellest of magicians. He cared not for the safety of his assistants. Often when their tricks went gruesomely wrong he would carelessly dispose and replace them with little thought to their families.\n\n**(Ingov has been injured, he cries out in pain.)**\n\n**Anna:** This never would have happened if Arav were here.\n\n**Bear** : Who was he?\n\n**Ingov** : The assistant before me.\n\n**(Anna drags on a suitcase)**\n\n**Anna:** Meet Arav. We found this in the woods last week, he was so full of potential, all those hours of rehearsal, wasted!\n\n**Bear** : How&#39;d you know it was him?\n\n**Anna** : He was a contortionist, only he could fit inside, whole, or as he is now. But mostly by his dental records.\n\n**Ingov:** But he was paranoid, he felt Comrade Batski was having him watched. He insisted we change our rehearsal spaces regularly, but now he&#39;s gone, we came back here.\n\n**Anna** : Kharkov insisted that we stay here, but Arav&#39;s suspicions about Men in black proved too much for him. Words were exchanged, and Arav..\n\n**Kharkov** : What are you doing with MY suitcase?\n\n**All:** (**Whisper aside to audience)** Kharkov is a tyrant.\n\n**Ingov:** He will take us away, and we will never be seen again.\n\n**All:** Kharkov has a terrible temper. Kharkov sees all.\n\n**Kharkov:** Why do you whisper? Do you plan to conspire?\n\n**(Silence/shock)**\n\n**Kharkov** : Hop to it. Positions for my new trick.\n\nLadies and gentlemen, I give you, &quot;People in Russia don&#39;t really go missing&quot;…  A metamorphosis!\n\n**(They perform trick)**\n\nKharkov: Not good enough, again!\n\n**(They perform the trick again, but Anna does not re-appear. Moment of silence and shock.)**\n\n**Narrator:** Before I let events continue. I feel obligated to inform you all that…Ingov was furiously in love with Anna, who was furiously in love with the Broken bear. However the bear, despite appreciating the affection that Anna poured upon him, saw her only as a motherly figure.\n\n**Ingov:** My love…what have you done with her?\n\n**Bear:…** Mama?\n\n**(They search for her, and discover an arm)**\n\n**Ingov:** I&#39;ll skin you alive, you fleabag!\n\n**(Fight scene/murder of Ingov)**\n\n**Kharkov:**  Stop! Stop I say, at once!\n\n**(Ingov dies a painful death)**\n\n**Kharkov:** Look what you&#39;ve done! We&#39;re ruined!\n\n**Narrator:** And for one final time, Kharkov dropped to his knees and cried…\n\n**(Bear removes mask and approaches Kharkov)**\n\n**Kharkov:** Comrade Batski! No, it can&#39;t be!\n\n**(Comrade Batski fires a single shot,  Kharkov drops dead, Comrade Batski turns his gun on the audience. BLACKOUT.)**";

        public DocumentContentPage()
        {
            InitializeComponent();

            var mdView = new Xam.Forms.Markdown.MarkdownView();
            mdView.Theme = new NicWritesMarkdownTheme();
            try
            {
               // mdView.Markdown = ViewModel.PlainDocText;
            }
            catch (Exception ex)
            {
                Console.WriteLine(ex.Message);

            }
            mdView.RelativeUrlHost = "";
            //this.Content = new ScrollView() { Content = mdView };

        }
        protected override void OnAppearing()
        {
            base.OnAppearing();
            mdView.Markdown = ViewModel.PlainDocText;
            this.ViewModel.PropertyChanged += Handle_PropertyChanged;
        }

        void Handle_PropertyChanged(object sender, System.ComponentModel.PropertyChangedEventArgs e)
        {
            if (e.PropertyName == "PlainDocText")
            {
                mdView.Markdown = ViewModel.PlainDocText;
            }
        }

    }
}
